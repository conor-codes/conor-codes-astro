---
import { getEntry, getCollection, render } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/Container.astro';
import Author from '@/components/ui/Author.astro';
import { DEFAULT_CONFIGURATION } from '@/lib/constants';
import WorkExperience from '@/components/ui/WorkExperience.astro';
import Talk from '@/components/ui/Talk.astro';
import Project from '@/components/ui/Project.astro';
import CodeAbout from '@/components/ui/CodeAbout.astro';
import { sortJobsByDate } from '@/lib/utils';
import ContactTerminal from '@/components/ContactTerminal.astro';
import RecentProjectsTerminal from '@/components/RecentProjectsTerminal.astro';


import { recentProjects } from '@/data/recent-projects';

const entry = await getEntry('pages', 'homepage');

if (!entry) {
  throw new Error('Homepage entry not found');
}

const { Content } = await render(entry);

const links = await getCollection('links');
const jobs = await getCollection('jobs');
const sortedJobs = sortJobsByDate(jobs);
const talks = await getCollection('talks');
const projects = await getCollection('projects');

//Sort projects by date if you want newest first
const sortedProjects = projects.sort((a, b) => {
  if (!a.data.date || !b.data.date) return 0;
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});
---
<BaseLayout seo={entry.data.seo}>
  <!-- Author Section -->
  <Container as="section" class="py-6 animate">
    <Author {...DEFAULT_CONFIGURATION.author} />
  </Container>

  <!-- Code About Section -->
  <Container as="section" class="py-6 animate">
    <div class="home-section">
      <div class="flex flex-col gap-6">
        <div class="code-font">
          <div><span class="keyword">using</span> System;</div>
          <div><span class="keyword">using</span> Location = <span class="string">"Liverpool, England"</span>;</div>
        </div>
        <div class="flex items-center code-font">
          <span class="text-headings">
            <span class="preprocessor">#region</span> <span class="class-name">About</span>
          </span>
        </div>
        <CodeAbout />
        <span class="preprocessor code-font">#endregion</span> 
      </div>
    </div>
  </Container>

  <!-- NEW - Use this instead -->
  <Container as="section" class="terminal-section animate">
    <div class="home-section">
      <h2 class="section-title">Contact</h2>
      <ContactTerminal />
      
      <h2 class="section-title" style="margin-top: 2rem;">Recent Projects</h2>
      <RecentProjectsTerminal projects={recentProjects} />
    </div>
  </Container>
</BaseLayout>